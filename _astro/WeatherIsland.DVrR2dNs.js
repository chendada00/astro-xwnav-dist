import{j as d}from"./jsx-runtime.D_zvdyIk.js";import{r as f}from"./index.BVOCwoKb.js";const j=36e5,p={æ™´:"â˜€ï¸",å¤šäº‘:"â›…",é˜´:"â˜ï¸",å°é›¨:"ğŸŒ¦ï¸",ä¸­é›¨:"ğŸŒ§ï¸",å¤§é›¨:"ğŸŒ§ï¸",é›·:"âš¡",é›ª:"â„ï¸",é›¾:"ğŸŒ«ï¸",æœªçŸ¥:"ğŸŒ¤ï¸"};function N(r,h,v="",g=null){console.log("å¤„ç†å¤©æ°”æ•°æ®");const w=new Date,$=w.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),c=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],C=w.getFullYear()+"å¹´"+(w.getMonth()+1)+"æœˆ"+w.getDate()+"æ—¥ æ˜ŸæœŸ"+c[w.getDay()]+" "+$;if(!r||r.error){console.error("å¤©æ°”æ•°æ®è·å–å¤±è´¥",r?.error);const n=r&&r.reason?r.reason:"è¯¥ä½ç½®æš‚ä¸æ”¯æŒ";return{location:v||"æœªçŸ¥ä½ç½®",condition:n,temperature:"N/A",tempRange:"N/A",airQuality:"N/A",time:$,fullDateTime:C,icon:p.æœªçŸ¥}}const b=r.current||{},u=b.weather_code||0,_=b.temperature_2m!==void 0?`${Math.round(b.temperature_2m)}Â°C`:"N/A";let k="N/A";if(r.daily){const n=r.daily.temperature_2m_min?.[0],a=r.daily.temperature_2m_max?.[0];n!==void 0&&a!==void 0&&(k=`${Math.round(n)}~${Math.round(a)}Â°C`)}let y="N/A";r.current&&r.current.relative_humidity_2m!==void 0&&(y=`${r.current.relative_humidity_2m}%`);let e="N/A";if(r.current&&r.current.european_aqi!==void 0){const n=r.current.european_aqi;let a="";n<=20?a="ä¼˜":n<=40?a="è‰¯":n<=60?a="ä¸­ç­‰":n<=80?a="ä¸€èˆ¬":n<=100?a="å·®":a="ä¸¥é‡",e=`${a} (${n})`}let t="æœªçŸ¥",o=p.æœªçŸ¥;return u!==void 0&&(u===0?(t="æ™´",o=p.æ™´):u===1?(t="å¤§éƒ¨æ™´æœ—",o=p.æ™´):u===2?(t="å±€éƒ¨å¤šäº‘",o=p.å¤šäº‘):u===3?(t="å¤šäº‘",o=p.å¤šäº‘):[45,48].includes(u)?(t="é›¾",o=p.é›¾):[51,53,55,56,57].includes(u)?(t="å°é›¨",o=p.å°é›¨):[61,63,66,80,81].includes(u)?(t="ä¸­é›¨",o=p.ä¸­é›¨):[65,67,82].includes(u)?(t="å¤§é›¨",o=p.å¤§é›¨):[95,96,99].includes(u)?(t="é›·é›¨",o=p.é›·):[71,73,75,77,85,86].includes(u)?(t="é›ª",o=p.é›ª):(t="é˜´",o=p.é˜´)),{location:v||"æœªçŸ¥ä½ç½®",condition:t,temperature:_,tempRange:k,airQuality:e,humidity:y,time:$,fullDateTime:C,icon:o}}function R(){const[r,h]=f.useState({location:"",condition:"",temperature:"",tempRange:"",airQuality:"",time:"",fullDateTime:"",icon:"ğŸŒ¤ï¸"}),[v,g]=f.useState(!0),[w,$]=f.useState(""),c=f.useRef({data:null,lastUpdated:0,location:"",coordinates:null}),C=async()=>{try{if(c.current.location&&c.current.coordinates)return console.log("ä½¿ç”¨ç¼“å­˜çš„ä½ç½®ä¿¡æ¯å’Œåæ ‡"),{location:c.current.location,coordinates:c.current.coordinates};console.log("æ­£åœ¨ä½¿ç”¨ api.myip.la è·å–åœ°åŒºä¿¡æ¯å’Œåæ ‡...");let e="",t=null;try{const o=new AbortController,n=setTimeout(()=>o.abort(),4e3),a=await fetch("https://api.myip.la/cn?json",{signal:o.signal,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36","Accept-Language":"zh-CN,zh;q=0.9"}});if(clearTimeout(n),a.ok){const i=await a.json();if(console.log("api.myip.la è¿”å›æ•°æ®:",i),i&&i.location){i.location.latitude&&i.location.longitude&&(t={latitude:parseFloat(i.location.latitude),longitude:parseFloat(i.location.longitude)},console.log(`ä» api.myip.la è·å–åˆ°åæ ‡: ${t.latitude}, ${t.longitude}`));const l=i.location.province||"",s=i.location.city||"";l&&s?(s.includes(l.replace("çœ","").replace("å¸‚","").replace("éƒ½",""))?e=s:e=l+s,console.log(`ä» api.myip.la è·å–åˆ°ä½ç½®: ${e}`)):l?e=l:s?e=s:i.location.country_name&&(e=i.location.country_name)}}}catch(o){console.warn("api.myip.la è·å–å¤±è´¥ï¼Œå°†å›é€€åˆ°å¤‡ç”¨æ–¹æ¡ˆ:",o.message)}if(!e){console.log("æ­£åœ¨ä½¿ç”¨å¤‡ç”¨ API myip.ipip.net è·å–åœ°åŒºä¿¡æ¯...");try{const o=await fetch("https://myip.ipip.net",{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36",Referer:"https://www.baidu.com/","Accept-Language":"zh-CN,zh;q=0.9","Keep-Alive":"yes","Cache-Control":"no-cache"}});if(o.ok){const n=await o.text();if(console.log("myip.ipip.net è¿”å›æ•°æ®:",n),n&&n.includes("æ¥è‡ªäºï¼š")){const a=n.split("æ¥è‡ªäºï¼š")[1];if(a){const i=a.split("  ")[0];if(i){const l=i.trim().split(" ");l.length>=3?e=l[1]+l[2]:l.length===2?e=l[1]:e=l[0],console.log(`ä» myip.ipip.net è·å–åˆ°ä½ç½®: ${e}`);try{console.log(`æ­£åœ¨ä½¿ç”¨ OpenStreetMap è·å– ${e} çš„åæ ‡...`),t=await b(e),t&&console.log(`æˆåŠŸè·å– ${e} çš„åæ ‡: ${t.latitude}, ${t.longitude}`)}catch(s){console.error(`è·å– ${e} åæ ‡å¤±è´¥:`,s)}}}}}}catch(o){console.error("å¤‡ç”¨ API ä¹Ÿå¤±è´¥äº†:",o.message)}}return e?(console.log(`æœ€ç»ˆä½¿ç”¨çš„ä½ç½®: ${e}`),c.current.location=e,c.current.coordinates=t,$(e),{location:e,coordinates:t}):(console.warn("æ— æ³•è·å–ä½ç½®ä¿¡æ¯"),{location:"",coordinates:null})}catch(e){return console.error("è·å–ä½ç½®ä¿¡æ¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:",e),{location:"",coordinates:null}}},b=async e=>{if(!e)return null;try{const t=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=1&accept-language=zh-Hans&countrycodes=CN`;console.log(`æ­£åœ¨è·å– ${e} çš„åæ ‡...`);const o=await fetch(t,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36","Accept-Language":"zh-CN,zh;q=0.9"}});if(!o.ok)throw new Error("åœ°ç†ç¼–ç è¯·æ±‚å¤±è´¥");const n=await o.json();if(n&&n.length>0){const{lat:a,lon:i}=n[0];return console.log(`è·å–åˆ° ${e} çš„åæ ‡: ${a}, ${i}`),{latitude:parseFloat(a),longitude:parseFloat(i)}}if(e.length>2){const a=e.substring(0,2);console.log(`å°è¯•ä½¿ç”¨çœä»½åç§°è·å–åæ ‡: ${a}`);const i=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(a)}&format=json&limit=1&accept-language=zh-Hans&countrycodes=CN`,l=await fetch(i,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36","Accept-Language":"zh-CN,zh;q=0.9"}});if(l.ok){const s=await l.json();if(s&&s.length>0){const{lat:x,lon:A}=s[0];return console.log(`ä½¿ç”¨çœä»½ ${a} çš„åæ ‡: ${x}, ${A}`),{latitude:parseFloat(x),longitude:parseFloat(A)}}}}return console.warn(`æ— æ³•è·å– ${e} çš„åæ ‡ï¼Œå¤©æ°”æœåŠ¡æš‚ä¸æ”¯æŒè¯¥åœ°åŒº`),null}catch(t){return console.error("è·å–åæ ‡å¤±è´¥:",t),null}},u=f.useRef(!1),_=f.useRef(0),k=5e3,y=async()=>{if(u.current){console.log("å¤©æ°”APIè°ƒç”¨æ­£åœ¨è¿›è¡Œä¸­ï¼Œè·³è¿‡é‡å¤è¯·æ±‚");return}const e=Date.now();if(e-_.current<k){console.log("å¤©æ°”APIè°ƒç”¨è¿‡äºé¢‘ç¹ï¼Œè·³è¿‡è¯·æ±‚");return}u.current=!0,_.current=e,g(!0);try{if(c.current.data&&e-c.current.lastUpdated<j){console.log("ä½¿ç”¨ç¼“å­˜çš„å¤©æ°”ä¿¡æ¯"),h(c.current.data),g(!1),u.current=!1;return}const{location:t,coordinates:o}=await C();if(console.log(`è·å–åˆ°ä½ç½®: ${t}`),!t){const m=N({error:!0,reason:"è¯¥ä½ç½®æš‚ä¸æ”¯æŒ"},e,"æœªçŸ¥ä½ç½®");h(m),g(!1);return}if(!o){const m=N({error:!0,reason:"æ— æ³•è·å–è¯¥ä½ç½®çš„åæ ‡"},e,t);h(m),g(!1);return}const n=`https://api.open-meteo.com/v1/forecast?latitude=${o.latitude}&longitude=${o.longitude}&current=temperature_2m,weather_code,relative_humidity_2m&daily=temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=1`,a=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${o.latitude}&longitude=${o.longitude}&current=european_aqi&timezone=auto`;console.log("æ­£åœ¨è·å–å¤©æ°”ä¿¡æ¯..."),console.log("å¤©æ°” API URL:",n),console.log("ç©ºæ°”è´¨é‡ API URL:",a);const i=new AbortController,l=setTimeout(()=>i.abort(),4e3),s=await fetch(n,{signal:i.signal,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36","Accept-Language":"zh-CN,zh;q=0.9"}});if(clearTimeout(l),!s.ok)throw new Error(`è·å–å¤©æ°”ä¿¡æ¯å¤±è´¥: ${s.status} ${s.statusText}`);const x=await s.json();console.log("å¤©æ°”æ•°æ®è·å–æˆåŠŸ:",x);let A={current:{european_aqi:null}};try{const m=new AbortController,L=setTimeout(()=>m.abort(),5e3),T=await fetch(a,{signal:m.signal,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36","Accept-Language":"zh-CN,zh;q=0.9"}});clearTimeout(L),T.ok?(A=await T.json(),console.log("ç©ºæ°”è´¨é‡æ•°æ®è·å–æˆåŠŸ:",A)):console.warn(`è·å–ç©ºæ°”è´¨é‡ä¿¡æ¯å¤±è´¥: ${T.status} ${T.statusText}`)}catch(m){console.warn("è·å–ç©ºæ°”è´¨é‡æ•°æ®æ—¶å‡ºé”™:",m)}const I={...x,current:{...x.current,european_aqi:A.current?.european_aqi}},W=N(I,e,t,o);c.current.data=W,c.current.lastUpdated=e,h(W),g(!1)}catch(t){console.error("è·å–å¤©æ°”ä¿¡æ¯å¤±è´¥:",t);const o=N({error:!0,reason:t.message},Date.now(),c.current.location||"æœªçŸ¥ä½ç½®");h(o),g(!1)}finally{u.current=!1}};return f.useEffect(()=>{let e=!0,t=null;const o=()=>{e&&("requestIdleCallback"in window?window.requestIdleCallback(()=>{e&&y()}):setTimeout(()=>{e&&y()},1e3))};return t=()=>{if(!e||document.visibilityState!=="visible")return;const n=Date.now();(!c.current.data||n-c.current.lastUpdated>j)&&(console.log("é¡µé¢å¯è§ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°å¤©æ°”ä¿¡æ¯"),y())},o(),document.addEventListener("visibilitychange",t,{passive:!0}),()=>{e=!1,t&&document.removeEventListener("visibilitychange",t)}},[]),d.jsx("div",{className:"mb-6 p-4 bg-gray-50/80 dark:bg-gray-800/80 backdrop-blur-xl rounded-2xl border border-black/5 dark:border-white/10 shadow-[0_2px_8px_rgba(0,0,0,0.06)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.15)]",children:d.jsxs("div",{className:"flex items-center justify-center",children:[d.jsx("span",{className:"text-2xl mr-3",children:r.icon}),d.jsxs("div",{className:"text-sm",children:[d.jsx("div",{className:"font-medium",children:"å½“åœ°å¤©æ°”"}),v?d.jsxs("div",{className:"text-gray-600 dark:text-gray-300 flex items-end",children:["åŠ è½½ä¸­",d.jsx("span",{className:"inline-block ml-px font-bold animate-wave",children:"."}),d.jsx("span",{className:"inline-block ml-px font-bold animate-wave [animation-delay:0.1s]",children:"."}),d.jsx("span",{className:"inline-block ml-px font-bold animate-wave [animation-delay:0.2s]",children:"."})]}):d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:`${r.location}: ${r.condition} ${r.temperature}`}),d.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:`${r.tempRange} | ç©ºæ°”è´¨é‡: ${r.airQuality} | æ¹¿åº¦: ${r.humidity}`}),r.fullDateTime&&d.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400","data-component-name":"WeatherIsland",children:`${r.fullDateTime}`})]})]})]})})}export{R as default};
